<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Minecraft Server Manager</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    h2 { margin-bottom: 10px; }
    label { display: inline-block; width: 70px; }
    select, input[type=file] { margin-bottom: 10px; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h2 id="serverName"></h2>

  <div>
    <label>Version:</label>
    <select id="version">
      <option>1.8</option>
      <option>1.12</option>
      <option>1.12.2</option>
      <option>1.16</option>
      <option>1.18</option>
      <option selected>1.20</option>
      <option>1.20.2</option>
      <option>1.20.4</option>
      <option>1.21</option>
      <option>1.21.1</option>
      <option>1.21.2</option>
      <option>1.22.0</option>
      <option>none</option>
    </select>
  </div>

  <div>
    <label>Type:</label>
    <select id="type">
      <option>vanilla</option>
      <option>forge</option>
      <option>fabric</option>
      <option>addon</option>
      <option>forgeoptifine</option>
    </select>
  </div>

  <button onclick="apply()">Apply</button>
  <button onclick="startServer()">Start Server</button>
  <button onclick="stopServer()">Stop Server</button>
  <button onclick="openConsole()">Console</button>
  
  <h3>Upload Plugin/Mod</h3>
  <input type="file" id="fileUpload" />
  <button onclick="uploadFile()">Upload</button>

  <script>
    const servername = location.pathname.split("/")[1].replace(".hoatreehub.com", "");
    document.getElementById("serverName").innerText = "Server: " + servername;

    async function apply() {
      const version = document.getElementById("version").value;
      const type = document.getElementById("type").value;
      await fetch(`/api/update/${servername}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ version, type })
      });
      alert("Updated!");
    }

    async function startServer() {
      const res = await fetch(`/api/start/${servername}`, { method: "POST" });
      const data = await res.json();
      alert(data.message || "Server started!");
    }

    async function stopServer() {
      const res = await fetch(`/api/stop/${servername}`, { method: "POST" });
      const data = await res.json();
      alert(data.message || "Server stopped!");
    }

    function openConsole() {
      window.open(`/servers/${servername}/console.log`, '_blank');
    }

    async function uploadFile() {
      const fileInput = document.getElementById("fileUpload");
      if (!fileInput.files.length) return alert("No file chosen");
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      const res = await fetch(`/api/upload/${servername}`, {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      alert(data.message || "Upload done");
    }
  </script>
</body>
</html>
